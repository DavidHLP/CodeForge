# SpringOJ 微服务权限信息传递系统 - 项目概述

## 1. 项目简介

SpringOJ 微服务权限信息传递系统是基于 **Spring Cloud Gateway** 和 **OpenFeign** 构建的分布式权限认证解决方案。该系统通过统一的网关入口对所有请求进行身份认证，并将用户权限信息通过HTTP头传递给下游微服务，实现了微服务架构中的统一权限管控。

## 2. 核心功能

### 2.1 统一权限网关

- **JWT Token 认证**：Gateway 层统一处理 JWT Token 验证
- **用户信息解析**：通过 OpenFeign 调用认证服务获取完整用户信息
- **权限信息注入**：将用户ID、用户名、邮箱、角色等信息注入请求头
- **请求路由转发**：认证通过后将请求转发至相应的下游服务

### 2.2 下游服务权限接收

- **透明权限获取**：下游服务无需关心认证逻辑，直接获取用户上下文
- **Spring Security 集成**：自动构建 SecurityContext，支持方法级权限控制
- **多环境适配**：支持 WebFlux 和 Servlet 两种环境
- **工具类支持**：提供便捷的用户信息获取工具类

### 2.3 权限信息传递机制

- **HTTP 头传递**：使用标准化的 HTTP 头字段传递用户信息
  - `X-User-Id`：用户唯一标识
  - `X-User-Name`：用户名
  - `X-User-Email`：用户邮箱
  - `X-User-Roles`：用户角色信息
- **安全性保障**：内网传递，避免敏感信息泄露
- **性能优化**：避免重复认证，提升系统整体性能

## 3. 技术架构特点

### 3.1 响应式编程支持

- **WebFlux 网关**：基于 Reactor 模式的非阻塞 I/O
- **异步认证**：使用 `Schedulers.boundedElastic()` 处理阻塞认证调用
- **高并发支持**：支持大量并发请求的高效处理

### 3.2 微服务友好

- **服务发现**：集成 Nacos 实现动态服务发现
- **负载均衡**：支持多种负载均衡策略
- **熔断降级**：集成 Sentinel 提供熔断保护
- **链路追踪**：支持分布式链路追踪

### 3.3 开发友好

- **注解驱动**：提供便捷的注解进行权限控制
- **工具类支持**：丰富的工具类简化权限判断
- **异常处理**：统一的异常处理机制
- **日志监控**：完整的日志记录和监控支持

## 4. 适用场景

### 4.1 中大型微服务架构

- **服务数量**：适用于 5+ 个微服务的系统
- **用户规模**：支持万级以上并发用户
- **权限复杂度**：支持多角色、多权限的复杂权限体系

### 4.2 典型业务场景

- **在线判题系统**：用户提交代码、查看题目、管理竞赛等
- **内容管理平台**：文章发布、评论管理、用户权限控制
- **电商平台**：订单管理、商品管理、用户中心等
- **企业OA系统**：审批流程、权限管控、组织架构管理

### 4.3 技术要求

- **Java 17+**：基于最新 JDK 特性
- **Spring Boot 3.x**：使用最新 Spring Boot 版本
- **Spring Cloud 2023.x**：完整的微服务技术栈
- **数据库支持**：MySQL、PostgreSQL 等关系型数据库

## 5. 系统优势

### 5.1 安全性

- **JWT Token**：无状态认证，支持分布式部署
- **权限隔离**：Gateway 统一认证，下游服务专注业务逻辑
- **内网传递**：用户信息仅在内网传递，降低安全风险
- **异常处理**：完善的异常处理和错误返回机制

### 5.2 性能优势

- **一次认证**：Gateway 统一认证，避免重复验证
- **异步处理**：响应式编程模式，支持高并发
- **缓存优化**：支持认证结果缓存，减少重复调用
- **负载均衡**：智能请求分发，提升系统吞吐量

### 5.3 开发效率

- **开箱即用**：提供完整的权限传递解决方案
- **工具丰富**：多种工具类简化开发工作
- **文档完善**：详细的使用文档和最佳实践
- **社区支持**：基于成熟开源框架，社区活跃

### 5.4 运维友好

- **监控集成**：支持 Actuator 健康检查和指标监控
- **日志规范**：统一的日志格式和级别管理
- **配置外化**：支持配置中心统一管理
- **部署简单**：容器化部署，支持 K8s 编排

## 6. 版本兼容性

| 组件            | 版本要求 | 说明                   |
| --------------- | -------- | ---------------------- |
| Java            | 17+      | 使用最新 LTS 版本特性  |
| Spring Boot     | 3.1+     | 支持原生镜像和虚拟线程 |
| Spring Cloud    | 2023.0+  | 最新微服务技术栈       |
| Spring Security | 6.1+     | 最新安全框架特性       |
| Nacos           | 2.3+     | 服务注册与配置管理     |
| Sentinel        | 1.8+     | 流量治理和熔断保护     |

## 7. 快速开始

本项目采用模块化设计，主要包含以下核心模块：

- **SpringOJ-gateway**：网关服务，负责统一认证和请求路由
- **security-commons**：安全组件，提供权限传递和接收功能
- **servlet-commons**：Servlet 环境支持，提供统一异常处理
- **webflux-commons**：WebFlux 环境支持，响应式异常处理

详细的架构设计、核心模块说明、使用示例和最佳实践请参考后续章节。

---

**下一章节：** [02-架构设计.md](./02-架构设计.md)
